THREE.EventDispatcherBootstrap=function(){},THREE.EventDispatcherBootstrap.prototype={apply:function(t){THREE.EventDispatcher.prototype.apply(t),t.dispatchEvent=THREE.EventDispatcherBootstrap.prototype.dispatchEvent,t.on=THREE.EventDispatcher.prototype.addEventListener,t.off=THREE.EventDispatcher.prototype.removeEventListener,t.trigger=t.dispatchEvent},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){e=e.slice();var i=e.length;t.target=this;for(var n=0;i>n;n++)e[n].call(this,t,this)}}}},THREE.Bootstrap=function(t){if(!(this instanceof THREE.Bootstrap))return new THREE.Bootstrap(t);var e={init:!0,element:document.body,plugins:["core"],klass:THREE.WebGLRenderer,parameters:{depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!0},plugindb:THREE.Bootstrap.Plugins||{},aliasdb:THREE.Bootstrap.Aliases||{}};this.__options=_.defaults(t||{},e),this.__options.parameters=_.defaults(this.__options.parameters,e.parameters),this.__inited=!1,this.__destroyed=!1,this.__binds=[],this.plugins={},this.__options.init&&this.init()},THREE.Bootstrap.prototype={init:function(){function t(t){for(var e=1024;e-->0;){var i=!1,n=[];if(_.each(t,function(t){r[t]?(n=n.concat(r[t]),i=!0):n.push(t)}),!i)return n;t=n}throw"Plug-in alias recursion detected"}if(!this.__inited){this.__inited=!0;var e,i,n=this.__options,s=n.plugindb,r=n.aliasdb,a=n.element;return i=t(n.plugins),e=this.renderer=new n.klass(n.parameters),this.canvas=e.domElement,this.element=a,a.appendChild(e.domElement),_.each(i,function(t){var e=s[t];if(e){if(this.plugins[t])return;var i=new e(n[t]||{},t);this.plugins[t]=i,_.extend(this,i.install(this)||{}),i.bind(this)}}.bind(this)),this.trigger({type:"ready"}),this}},destroy:function(){if(this.__inited&&!this.__destroyed){this.__destroyed=!0;{this.__options}return _.each(this.plugins,function(t){t.uninstall(this)}.bind(this)),this.plugins={},this.unbind(),this.element.removeChild(this.renderer.domElement),this.renderer=null,this}},bind:function(t,e){var i=this;_.isArray(t)&&(i=t[0],t=t[1]);for(var n=/^([^.:]*(?:\.[^.:]+)*)?(?:\:(.*))?$/.exec(t),s=n[1].split(/\./g),r=s.pop(),a=n[2]||r,o={"":i,"this":e,three:this,element:this.element,canvas:this.canvas,window:window}[s.shift()]||i;o&&(t=s.shift());)o=o[t];if(!o||!o.on&&!o.addEventListener)throw"Cannot bind '"+t+"' in "+this.__name;var h=function(t){e[a]&&e[a](t,this)}.bind(this),p=!1;["addEventListener","on"].map(function(t){!p&&o[t]&&(p=!0,o[t](r,h))});var l={target:o,name:r,callback:h};this.__binds.push(l)},unbind:function(){this.__binds.forEach(function(t){var e=!1;["removeEventListener","off"].map(function(i){!e&&t.target[i]&&(e=!0,t.target[i](t.name,t.callback))})}),this.__binds=[]}},THREE.EventDispatcherBootstrap.prototype.apply(THREE.Bootstrap.prototype),THREE.Bootstrap.Plugins={},THREE.Bootstrap.Aliases={},THREE.Bootstrap.Plugin=function(t){this.options=_.defaults(t||{},this.defaults),this.__binds=[]},THREE.Bootstrap.Plugin.prototype={listen:[],defaults:{},install:function(){},uninstall:function(){},set:function(t){var e=this.options,i=_.reduce(t,function(t,i,n){return e[n]!==i&&(t[n]=i),t},{});_.extend(e,i),this.dispatchEvent({type:"change",changes:i})},get:function(){return this.options},api:function(t){return t=t||{},t.set=this.set.bind(this),t.get=this.get.bind(this),t},bind:function(t){this.listen.forEach(function(e){t.bind(e,this)}.bind(this))}},THREE.EventDispatcherBootstrap.prototype.apply(THREE.Bootstrap.Plugin.prototype),THREE.Bootstrap.registerPlugin=function(t,e){var i=function(e){THREE.Bootstrap.Plugin.call(this,e),this.__name=t};i.prototype=_.extend(new THREE.Bootstrap.Plugin,e),THREE.Bootstrap.Plugins[t]=i},THREE.Bootstrap.unregisterPlugin=function(t){delete THREE.Bootstrap.Plugins[t]},THREE.Bootstrap.registerAlias=function(t,e){THREE.Bootstrap.Aliases[t]=e},THREE.Bootstrap.unregisterAlias=function(t){delete THREE.Bootstrap.Aliases[t]},THREE.Bootstrap.registerAlias("empty",["size","fill","loop","time"]),THREE.Bootstrap.registerAlias("core",["empty","scene","camera","render"]),THREE.Bootstrap.registerPlugin("size",{defaults:{width:null,height:null,aspect:null,scale:1,capWidth:1/0,capHeight:1/0},listen:["window.resize","element.resize","this.change:resize","ready:resize"],install:function(t){t.Size=this.api({renderWidth:0,renderHeight:0,viewWidth:0,viewHeight:0})},uninstall:function(t){delete t.Size},resize:function(t,e){var i,n,s,r,a,o,h,p,l=this.options,c=e.element,d=e.renderer,u=0,E=0;i=s=void 0===l.width||null==l.width?c.offsetWidth||c.innerWidth||0:l.width,n=r=void 0===l.height||null==l.height?c.offsetHeight||c.innerHeight||0:l.height,h=i/n,l.aspect&&(l.aspect>h?(n=Math.round(i/l.aspect),E=Math.floor((r-n)/2)):(i=Math.round(n*l.aspect),u=Math.floor((s-i)/2)),h=l.aspect),a=Math.min(i*l.scale,l.capWidth),o=Math.min(n*l.scale,l.capHeight),raspect=a/o,raspect>h?a=Math.round(o*h):o=Math.round(a/h),d.setSize(a,o),p=d.domElement.style,p.width=i+"px",p.height=n+"px",p.marginLeft=u+"px",p.marginTop=E+"px",_.extend(e.Size,{renderWidth:a,renderHeight:o,viewWidth:i,viewHeight:n}),e.dispatchEvent({type:"resize",renderWidth:a,renderHeight:o,viewWidth:i,viewHeight:n})}}),THREE.Bootstrap.registerPlugin("fill",{install:function(t){function e(t){var e=t.style.height;return"auto"==e||""==e}function i(t){return t.style.height="100%",t.style.margin=0,t.style.padding=0,t}t.element==document.body&&(this.applied=[t.element,document.documentElement].filter(e).map(i))},uninstall:function(){function t(t){return t.style.height="",t.style.margin="",t.style.padding="",t}this.applied&&this.applied.map(t)}}),THREE.Bootstrap.registerPlugin("loop",{defaults:{start:!0},listen:["ready"],install:function(t){this.three=t,this.running=!1,t.Loop=this.api({start:this.start.bind(this),stop:this.stop.bind(this),running:!1})},uninstall:function(){this.stop()},ready:function(){this.options.start&&this.start()},start:function(){if(!this.running){this.three.Loop.running=this.running=!0;var t=function(){this.running&&requestAnimationFrame(t),["pre","update","render","post"].map(function(t){this.three.dispatchEvent({type:t})}.bind(this))}.bind(this);requestAnimationFrame(t),this.three.dispatchEvent({type:"start"})}},stop:function(){this.running&&(this.three.Loop.running=this.running=!1,this.three.dispatchEvent({type:"stop"}))}}),THREE.Bootstrap.registerPlugin("time",{listen:["pre:tick","post:tick"],install:function(t){t.Time=this.api({now:0,delta:1/60,average:0,fps:0}),this.last=0},tick:function(t,e){var i=e.Time,n=i.now=+new Date/1e3,s=this.last;if(s){var r=i.delta=n-s,a=i.average||r;i.average=a+.1*(r-a),i.fps=1/a}this.last=n},uninstall:function(t){delete t.Time}}),THREE.Bootstrap.registerPlugin("scene",{install:function(t){t.scene=new THREE.Scene},uninstall:function(t){delete t.scene}}),THREE.Bootstrap.registerPlugin("camera",{defaults:{near:.1,far:1e4,type:"perspective",fov:60,aspect:null,left:-1,right:1,bottom:-1,top:1},listen:["resize","this.change"],install:function(t){t.Camera=this.api(),t.camera=null,this.aspect=1,this.change({},t)},uninstall:function(t){delete t.Camera,delete t.camera},change:function(t,e){var i=this.options;if(e.camera&&!t.changes.type)["near","far","left","right","top","bottom","fov"].map(function(t){void 0!==i[t]&&(e.camera[t]=i[t])}.bind(this));else switch(this.cameraType=i.type,i.type){case"perspective":e.camera=new THREE.PerspectiveCamera(i.fov,this.aspect,i.near,i.far);break;case"orthographic":e.camera=new THREE.OrthographicCamera(i.left,i.right,i.top,i.bottom,i.near,i.far)}e.camera.updateProjectionMatrix(),e.trigger({type:"camera",camera:e.camera})},resize:function(t,e){this.aspect=this.options.aspect||t.viewWidth/Math.max(1,t.viewHeight)||1,e.camera.aspect=this.aspect,e.camera.updateProjectionMatrix()}}),THREE.Bootstrap.registerPlugin("render",{listen:["render"],render:function(t,e){e.scene&&e.camera&&e.renderer.render(e.scene,e.camera)}});