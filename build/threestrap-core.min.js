THREE.Bootstrap=function(t){if(!(this instanceof THREE.Bootstrap))return new THREE.Bootstrap(t);var e={init:!0,element:document.body,plugins:["core"],klass:THREE.WebGLRenderer,parameters:{depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!0},plugindb:THREE.Bootstrap.Plugins||{},aliasdb:THREE.Bootstrap.Aliases||{}};this.__options=_.defaults(t||{},e),this.__options.parameters=_.defaults(this.__options.parameters,e.parameters),this.__inited=!1,this.__destroyed=!1,this.plugins={},this.__options.init&&this.init()},THREE.Bootstrap.prototype={init:function(){function t(t){for(var e=1024;e-->0;){var i=!1,s=[];if(_.each(t,function(t){n[t]?(s=s.concat(n[t]),i=!0):s.push(t)}),!i)return s;t=s}throw"Plug-in alias recursion detected"}if(!this.__inited){this.__inited=!0;var e=this.__options,i=e.plugindb,n=e.aliasdb,s=e.element,r=t(e.plugins),a=this.renderer=new e.klass(e.parameters);return this.canvas=a.domElement,this.element=s,s.appendChild(a.domElement),_.each(r,function(t){var n=i[t];if(n){if(this.plugins[t])throw"Duplicate plugin '"+t+"'";var r=new n(e[t]||{});this.plugins[t]=r,_.extend(this,r.install(this,a,s)||{})}}.bind(this)),this.dispatchEvent({type:"ready"}),this}},destroy:function(){if(this.__inited&&!this.__destroyed){this.__destroyed=!0;var t=this.__options,e=this.renderer,i=t.element;return _.each(this.plugins,function(t){t.uninstall(this,e,i)}.bind(this)),this.plugins={},i.removeChild(e.domElement),this.renderer=null,this}}},THREE.EventDispatcher.prototype.apply(THREE.Bootstrap.prototype),THREE.Bootstrap.prototype.onceEventListener=function(t,e){var i=function(n){this.removeEventListener(t,i),e(n)}.bind(this);this.addEventListener(t,i)},THREE.Bootstrap.Plugins={},THREE.Bootstrap.Aliases={},THREE.Bootstrap.Plugin=function(t){this.options=_.defaults(t||{},this.defaults)},THREE.Bootstrap.Plugin.prototype={defaults:{},install:function(){},uninstall:function(){},set:function(t){_.extend(this.options,t),this.dispatchEvent({type:"change",changes:t})},get:function(){return this.options},api:function(t){return t=t||{},t.set=this.set.bind(this),t.get=this.get.bind(this),t}},THREE.EventDispatcher.prototype.apply(THREE.Bootstrap.Plugin.prototype),THREE.Bootstrap.registerPlugin=function(t,e){var i=function(t){THREE.Bootstrap.Plugin.call(this,t)};i.prototype=_.extend(new THREE.Bootstrap.Plugin,e),THREE.Bootstrap.Plugins[t]=i},THREE.Bootstrap.unregisterPlugin=function(t){delete THREE.Bootstrap.Plugins[t]},THREE.Bootstrap.registerAlias=function(t,e){THREE.Bootstrap.Aliases[t]=e},THREE.Bootstrap.unregisterAlias=function(t){delete THREE.Bootstrap.Aliases[t]},THREE.Bootstrap.registerAlias("empty",["size","fill","loop","time"]),THREE.Bootstrap.registerAlias("core",["empty","scene","camera","render"]),THREE.Bootstrap.registerPlugin("size",{defaults:{width:null,height:null,aspect:null,scale:1,capWidth:1/0,capHeight:1/0},install:function(t,e,i){this.handler=function(){var n,s,r,a,o,h,p,l,d=this.options,c=0,u=0;n=r=void 0===d.width||null==d.width?i.offsetWidth||i.innerWidth||0:d.width,s=a=void 0===d.height||null==d.height?i.offsetHeight||i.innerHeight||0:d.height,p=n/s,d.aspect&&(d.aspect>p?(s=Math.round(n/d.aspect),u=Math.floor((a-s)/2)):(n=Math.round(s*d.aspect),c=Math.floor((r-n)/2)),p=d.aspect),o=Math.min(n*d.scale,d.capWidth),h=Math.min(s*d.scale,d.capHeight),raspect=o/h,raspect>p?o=Math.round(h*p):h=Math.round(o/p),e.setSize(o,h),l=e.domElement.style,l.width=n+"px",l.height=s+"px",l.marginLeft=c+"px",l.marginTop=u+"px",_.extend(t.Size,{renderWidth:o,renderHeight:h,viewWidth:n,viewHeight:s}),t.dispatchEvent({type:"resize",renderWidth:o,renderHeight:h,viewWidth:n,viewHeight:s})}.bind(this),window.addEventListener("resize",this.handler),i.addEventListener("resize",this.handler),t.addEventListener("ready",this.handler),t.Size=this.api({renderWidth:0,renderHeight:0,viewWidth:0,viewHeight:0}),this.addEventListener("change",this.handler)},uninstall:function(t,e,i){window.removeEventListener("resize",this.handler),i.removeEventListener("resize",this.handler),t.removeEventListener("ready",this.handler),delete t.Size}}),THREE.Bootstrap.registerPlugin("fill",{install:function(t,e,i){function n(t){var e=t.style.height;return"auto"==e||""==e}function s(t){return t.style.height="100%",t.style.margin=0,t.style.padding=0,t}i==document.body&&(this.applied=[i,document.documentElement].filter(n).map(s))},uninstall:function(){function t(t){return t.style.height="",t.style.margin="",t.style.padding="",t}this.applied&&this.applied.map(t)}}),THREE.Bootstrap.registerPlugin("loop",{defaults:{start:!0},install:function(t){this.three=t,this.running=!1,this.options.start&&t.onceEventListener("ready",this.start.bind(this)),t.Loop=this.api({start:this.start.bind(this),stop:this.stop.bind(this),running:!1})},uninstall:function(){this.stop()},start:function(){if(!this.running){this.three.Loop.running=this.running=!0,this.three.dispatchEvent({type:"start"});var t=function(){this.running&&requestAnimationFrame(t),["pre","update","render","post"].map(function(t){this.three.dispatchEvent({type:t})}.bind(this))}.bind(this);requestAnimationFrame(t)}},stop:function(){this.running&&(this.running=!1,this.three.dispatchEvent({type:"stop"}))}}),THREE.Bootstrap.registerPlugin("time",{install:function(t){var e=t.Time=this.api({now:0,delta:1/60,average:0,fps:0}),i=0;this.tick=function(){var t=e.now=+new Date/1e3;if(i){var n=e.delta=t-i,s=e.average||n;e.average=s+.1*(n-s),e.fps=1/s}i=t},t.addEventListener("pre",this.tick)},uninstall:function(t){t.removeEventListener("pre",this.tick),delete t.Time}}),THREE.Bootstrap.registerPlugin("scene",{install:function(t){this.scene=new THREE.Scene,t.scene=this.scene},uninstall:function(t){delete t.scene}}),THREE.Bootstrap.registerPlugin("camera",{defaults:{near:.1,far:1e4,type:"perspective",fov:60,aspect:"auto",left:-1,right:1,bottom:-1,top:1},install:function(t){this.three=t,this.handler=this.resize.bind(this),t.addEventListener("resize",this.handler),t.Camera=this.api(),t.camera=null,this.aspect=1,this.change(),this.addEventListener("change",this.change.bind(this))},uninstall:function(t){t.removeEventListener("resize",this.handler),delete t.Camera,delete t.camera},change:function(){var t=this.options;if(this.camera&&t.type==this.cameraType)["near","far","left","right","top","bottom","fov"].map(function(e){void 0!==t[e]&&(this.camera[e]=t[e])}.bind(this));else switch(t.type){case"perspective":this.camera=new THREE.PerspectiveCamera(t.fov,1,t.near,t.far);break;case"orthographic":this.camera=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far)}this.cameraType=t.type,this.three.camera=this.camera,this.update()},update:function(){var t=this.options;"auto"==t.aspect&&(t.aspect=0),this.camera.aspect=t.aspect||this.aspect,this.camera.updateProjectionMatrix(),this.three.dispatchEvent({type:"camera",camera:this.camera})},resize:function(t){this.aspect=t.viewWidth/Math.max(1,t.viewHeight)||1,this.update()}}),THREE.Bootstrap.registerPlugin("render",{install:function(t,e){this.handler=function(){t.scene&&t.camera&&e.render(t.scene,t.camera)},t.addEventListener("render",this.handler)},uninstall:function(t){t.removeEventListener("render",this.handler)}});